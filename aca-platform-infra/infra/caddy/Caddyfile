{
    # Global Caddy configuration for certificate management.
    #
    # The email address is used for ACME registration when obtaining
    # certificates from Let's Encrypt.  At deployment time the script
    # injects the LETS_ENCRYPT_EMAIL environment variable, which Caddy
    # substitutes here.  See the Caddy documentation for other global
    # options: https://caddyserver.com/docs/caddyfile/options
    email {$LETS_ENCRYPT_EMAIL}
}

#
# Caddy site configuration (multi-domain)
#
# Each container app has its own custom domain.  We define one site
# per domain and route all requests to the corresponding backend.  The
# backend hostnames (`APP1_HOST` and `APP2_HOST`) are injected by the
# deployment script.  Caddy obtains and renews certificates for
# `APP1_DOMAIN` and `APP2_DOMAIN` automatically via ACME.

{$APP1_DOMAIN} {
    log
    # Forward all traffic for app1's domain to the internal container app.
    reverse_proxy {$APP1_HOST}
}

{$APP2_DOMAIN} {
    log
    # Forward all traffic for app2's domain to the internal container app.
    reverse_proxy {$APP2_HOST}
}

# Optionally, you can define a catch‑all host or root domain here to
# display a landing page or status.  For example:
# {${ROOT_DOMAIN}} {
#     respond "Welcome to the Caddy reverse proxy!" 200
# }